<h1 align="center" style="color:yellow">HX-LinuxMonitor</h1>

## 一、介绍
包含两个程序, 提供QT5界面程序以及对应的内核模块:

```md
# 文件监控服务 - 用户需求

## 一、需求
### 1.1 文件清单

用户可以选择文件, 加入`文件清单`; 程序会记录选择的文件的 **绝对路径**, 以确保无歧义.

### 1.2 指定进程

用户可以指定进程, 加入`白名单`; 程序会记录选择的进程的 **启动路径** 的 **绝对路径** 作为唯一进程标识. 

### 1.3 可拦截读写系统调用

对 `文件清单` 内的文件进行读写操作时, 需要拦截 **非** 白名单 的进程.

### 1.4 日志系统-

日志记录:

> [触发时间] [触发进程(全路径)] [该进程操作对象(文件)] [该进程操作内容] [本程序处理结果]
```

```md
# 网络请求监控服务 - 用户需求

## 一、需求
### 1.1 上班时间

用户可以定义 `上班区间`; 其输入格式示例: `09:00~12:00, 13:30~18:00` (使用二十四小时制; 如果有多个区间, 需要使用`英文逗号`隔开)

> (注意: 需要判断区间是否为合法区间 如 `23:00~04:00` 应该写为 `23:00~24:00, 00:00~04:00`)

### 1.2 指定非法网络请求

用户可以指定 `黑名单` 网址 (以 `ip:端口` 的格式指定, 多的可分行 (符合用户习惯))

### 1.3 拦截非法网络请求

程序会监听所有的网络请求; 在 `上班时间` 内, 对于所有网络请求, 程序需要拦截 `黑名单` 的请求.

### 1.4 日志系统

日志记录:

> [触发时间] [触发进程(全路径)] [请求目标(网址)] [请求内容] [程序处理结果]
```

> [!TIP]
> 内部实现:
>
> `01-file 内核模块`: 是基于 `kretprobe` 来 **HOOK** `do_sys_open` 实现的.
>
> `02-net 内核模块`: 是基于 `Netfilter/iptables` 来 **HOOK** `NF_IP_LOCAL_OUT` 实现的.

## 二、使用

使用 `sudo` 启动 QT-GUI 程序, 即可编写配置文件.

> [!TIP]
> 内核模块可能需要手动编译, 以符合自己的 Linux 发行版、内核版本.
>
> ```bash
> # 开发/测试环境, 麒麟OS:
> loli@loli-pc:~/code/HX-LinuxMonitor$ uname -a
> Linux loli-pc 5.10.0-18-generic #1~v10pro-KYLINOS SMP Mon Mar 17 11:49:02 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux
> ```

## 三、构建

cmake 负责编译 qt-cpp 程序

make 负责编译内核模块

make示例:

```bash
cd 01-file
make        # 编译
make i      # 加载内核模块
make info   # 实时查看内核日志
make log    # 实时查看过滤的内核日志
make d      # 查看内核日志的最后5条内容
make un     # 卸载内核日志
```

## 四、开源协议

GPL3. 如果有任何问题欢迎提 Issues 或者 PR~